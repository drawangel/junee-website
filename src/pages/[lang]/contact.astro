---
import Layout from '../../layouts/Layout.astro';
import { useTranslations } from '../../i18n';

const { lang } = Astro.params;
const t = useTranslations(lang);
---

<Layout title={t('contact.title')} description={t('contact.description')}>
  <main class="flex-grow">
    <div class="container mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 py-16 sm:py-24">
      <div class="grid grid-cols-1 gap-12 lg:grid-cols-2 lg:gap-16">
        <!-- Left Column: Heading & Text -->
        <div class="flex flex-col justify-center">
          <div class="flex flex-col gap-4">
            <h1 class="text-4xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white sm:text-5xl lg:text-6xl">
              {t('contact.hero.title')}
            </h1>
            <p class="text-gray-600 dark:text-gray-400 text-lg font-normal leading-normal">
              {t('contact.hero.subtitle')}
            </p>
          </div>
        </div>

        <!-- Right Column: Form -->
        <div class="w-full">
          <div class="rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 p-6 sm:p-8 shadow-sm">
            <form action="https://api.web3forms.com/submit" method="POST" class="space-y-6">
              <input type="hidden" name="access_key" value="2d84aac6-5a5d-4582-9a4f-22aadfb6beb1" />
              <input type="hidden" name="subject" value={t('contact.form.subject')} />
              <input type="hidden" name="from_name" value={t('contact.form.fromName')} />
              <input type="checkbox" name="botcheck" class="hidden" style="display: none;" tabindex="-1" autocomplete="off" />

              <!-- Nombre -->
              <div>
                <label class="flex flex-col">
                  <p class="text-sm font-medium text-gray-900 dark:text-white leading-normal pb-2">{t('contact.form.name')}</p>
                  <input
                    class="w-full rounded-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary border-2 border-gray-400 dark:border-gray-600 bg-white dark:bg-gray-900 focus:border-primary h-16 placeholder:text-gray-400 px-4 text-base font-normal leading-normal transition-all"
                    name="name"
                    placeholder={t('contact.form.namePlaceholder')}
                    required
                    type="text"
                  />
                </label>
              </div>

              <!-- Empresa -->
              <div>
                <label class="flex flex-col">
                  <p class="text-sm font-medium text-gray-900 dark:text-white leading-normal pb-2">{t('contact.form.company')}</p>
                  <input
                    class="w-full rounded-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary border-2 border-gray-400 dark:border-gray-600 bg-white dark:bg-gray-900 focus:border-primary h-16 placeholder:text-gray-400 px-4 text-base font-normal leading-normal transition-all"
                    name="company"
                    placeholder={t('contact.form.companyPlaceholder')}
                    required
                    type="text"
                  />
                </label>
              </div>

              <!-- Email -->
              <div>
                <label class="flex flex-col">
                  <p class="text-sm font-medium text-gray-900 dark:text-white leading-normal pb-2">{t('contact.form.email')}</p>
                  <input
                    class="w-full rounded-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary border-2 border-gray-400 dark:border-gray-600 bg-white dark:bg-gray-900 focus:border-primary h-16 placeholder:text-gray-400 px-4 text-base font-normal leading-normal transition-all"
                    name="email"
                    placeholder={t('contact.form.emailPlaceholder')}
                    required
                    type="email"
                  />
                </label>
              </div>

              <!-- Sector -->
              <div>
                <label class="flex flex-col">
                  <p class="text-sm font-medium text-gray-900 dark:text-white leading-normal pb-2">{t('contact.form.sector')}</p>
                  <div class="relative">
                    <select
                      class="w-full appearance-none rounded-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary border-2 border-gray-400 dark:border-gray-600 bg-white dark:bg-gray-900 focus:border-primary h-16 px-4 pr-12 text-base font-normal leading-normal transition-all cursor-pointer"
                      name="sector"
                      required
                    >
                      <option disabled selected value="">{t('contact.form.sectorPlaceholder')}</option>
                      <option value="fashion">{t('contact.form.sectorOptions.fashion')}</option>
                      <option value="electronics">{t('contact.form.sectorOptions.electronics')}</option>
                      <option value="home">{t('contact.form.sectorOptions.home')}</option>
                      <option value="beauty">{t('contact.form.sectorOptions.beauty')}</option>
                      <option value="food">{t('contact.form.sectorOptions.food')}</option>
                      <option value="other">{t('contact.form.sectorOptions.other')}</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4 text-gray-600 dark:text-gray-400">
                      <svg class="h-6 w-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
                      </svg>
                    </div>
                  </div>
                </label>
              </div>

              <!-- SKUs -->
              <div>
                <label class="flex flex-col">
                  <p class="text-sm font-medium text-gray-900 dark:text-white leading-normal pb-2">{t('contact.form.skus')}</p>
                  <input
                    class="w-full rounded-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary border-2 border-gray-400 dark:border-gray-600 bg-white dark:bg-gray-900 focus:border-primary h-16 placeholder:text-gray-400 px-4 text-base font-normal leading-normal transition-all"
                    min="0"
                    name="skus"
                    placeholder={t('contact.form.skusPlaceholder')}
                    required
                    type="number"
                  />
                </label>
              </div>

              <!-- Submit Button -->
              <div>
                <button
                  class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-6 bg-primary text-white text-base font-bold leading-normal tracking-wide hover:opacity-90 transition-opacity mt-2"
                  type="submit"
                >
                  <span class="truncate">{t('contact.form.submit')}</span>
                </button>
              </div>

              <!-- Subtext -->
              <p class="text-center text-sm text-gray-500 dark:text-gray-400">{t('contact.form.tagline')}</p>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script define:vars={{ sending: t('contact.form.sending'), success: t('contact.form.success'), error: t('contact.form.error') }}>
  const form = document.querySelector('form');
  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const button = form.querySelector('button[type="submit"]');
      const originalText = button?.querySelector('span')?.textContent;

      if (button) {
        button.disabled = true;
        const span = button.querySelector('span');
        if (span) span.textContent = sending;
      }

      try {
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          body: formData
        });

        if (response.ok) {
          if (button) {
            const span = button.querySelector('span');
            if (span) span.textContent = success;
          }
          form.reset();
          setTimeout(() => {
            if (button) {
              button.disabled = false;
              const span = button.querySelector('span');
              if (span && originalText) span.textContent = originalText;
            }
          }, 3000);
        } else {
          throw new Error('Error en el env√≠o');
        }
      } catch (err) {
        if (button) {
          button.disabled = false;
          const span = button.querySelector('span');
          if (span && originalText) span.textContent = originalText;
        }
        alert(error);
      }
    });
  }
</script>
